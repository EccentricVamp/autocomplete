!function(e,t){"function"==typeof define&&define.amd?define("autocomplete",[],t):"object"==typeof exports?module.exports=t(require,exports):t(null,e)}(this,function(e,t){"use strict";function n(e){function t(){E++,m=[],u=void 0,h.display="none"}function n(){for(;v.firstChild;)v.removeChild(v.firstChild);var n=!1,i="#9?$";m.forEach(function(e){e.group&&(n=!0)});var r=function(e){var t=p.createElement("div");return t.textContent=e.label,t};if(e.render&&(r=e.render),m.forEach(function(n){if(n.group&&n.group!==i){i=n.group;var o=p.createElement("div");o.className="group",o.textContent=n.group,v.appendChild(o)}var l=r(n);l&&(l.addEventListener("click",function(i){e.itemSelected(n.item,s),t(),i.preventDefault(),i.stopPropagation()}),n===u&&(l.className+=" selected"),v.appendChild(l))}),e.emptyMsg&&m.length<1){var l=p.createElement("div");l.className="empty",l.textContent=e.emptyMsg,v.appendChild(l)}var a=s.getBoundingClientRect(),f=a.top+s.offsetHeight;h.top=f+"px",h.left=a.left+"px",h.width=s.offsetWidth+"px",h.maxHeight=window.innerHeight-f+"px",h.height="auto",h.display="block",o()}function i(i){var o=i.which||i.keyCode||0,r=++E;if(38!==o&&40!==o&&13!==o){if(27===o)return void t();s.value.length>=g?s.value!==c&&e.fetch(s.value,function(e){E===r&&e&&(m=e,u=m.length>0?m[0]:void 0,n())}):t(),c=s.value}}function o(){var e=v.getElementsByClassName("selected");if(e.length>0){var t=e[0],n=t.previousElementSibling;if(n&&n.className.indexOf("group")!==-1&&!n.previousElementSibling&&(t=n),t.offsetTop<v.scrollTop)v.scrollTop=t.offsetTop;else{var i=t.offsetTop+t.offsetHeight,o=v.scrollTop+v.offsetHeight;i>o&&(v.scrollTop+=i-o)}}}function r(){if(m.length<1)u=void 0;else if(u===m[0])u=m[m.length-1];else for(var e=m.length-1;e>0;e--)if(u===m[e]||1===e){u=m[e-1];break}}function l(){if(m.length<1&&(u=void 0),!u||u===m[m.length-1])return void(u=m[0]);for(var e=0;e<m.length-1;e++)if(u===m[e]){u=m[e+1];break}}function a(i){var o=i.which||i.keyCode||0;return 38===o||40===o?(38===o?r():l(),n(),void i.preventDefault()):void(13===o&&u&&(e.itemSelected(u.item,s),t()))}function f(){setTimeout(function(){p.activeElement!==s&&t()},100)}function d(){s.removeEventListener("keydown",a),s.removeEventListener("keyup",i),s.removeEventListener("focus",i),s.removeEventListener("blur",f),t();var e=v.parentNode;e&&e.removeChild(v)}var s,u,c,p=document,v=p.createElement("div"),h=v.style,m=[],g=e.minLength||2,E=0;if(!e.input)throw"input undefined";return s=e.input,c=s.value,p.body.appendChild(v),v.className="autocomplete "+(e.className||""),h.position="absolute",s.addEventListener("keydown",a),s.addEventListener("keyup",i),s.addEventListener("focus",i),s.addEventListener("blur",f),{destroy:d}}t.autocomplete=n});